<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>Docker | DAY's Blog</title><meta name="keywords" content="Docker,Linux,Notes"><meta name="author" content="santidad DAY"><meta name="copyright" content="santidad DAY"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="关于Docker的基本命令,及如何将自己的镜像发布到DockerHub或阿里云镜像服务中,Docker网路的入门">
<meta property="og:type" content="article">
<meta property="og:title" content="Docker">
<meta property="og:url" content="https://santidadday.github.io/2023/02/27/Docker/index.html">
<meta property="og:site_name" content="DAY&#39;s Blog">
<meta property="og:description" content="关于Docker的基本命令,及如何将自己的镜像发布到DockerHub或阿里云镜像服务中,Docker网路的入门">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://www.ondat.io/hubfs/Docker.png">
<meta property="article:published_time" content="2023-02-26T16:00:00.000Z">
<meta property="article:modified_time" content="2023-04-13T13:29:12.970Z">
<meta property="article:author" content="santidad DAY">
<meta property="article:tag" content="Docker">
<meta property="article:tag" content="Linux">
<meta property="article:tag" content="Notes">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://www.ondat.io/hubfs/Docker.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://santidadday.github.io/2023/02/27/Docker/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: 'days',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Docker',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-04-13 21:29:12'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/day.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data is-center"><div class="data-item"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">17</div></a></div><div class="data-item"><a href="/tags/"><div class="headline">Tags</div><div class="length-num">9</div></a></div><div class="data-item"><a href="/categories/"><div class="headline">Categories</div><div class="length-num">1</div></a></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">DAY's Blog</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">Docker</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="fa-fw post-meta-icon far fa-calendar-alt"></i><span class="post-meta-label">Created</span><time datetime="2023-02-26T16:00:00.000Z" title="Created 2023-02-27 00:00:00">2023-02-27</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Docker"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div><article class="post-content" id="article-container"><h2 id="Docker概述"><a href="#Docker概述" class="headerlink" title="Docker概述"></a>Docker概述</h2><h3 id="Docker为什么出现"><a href="#Docker为什么出现" class="headerlink" title="Docker为什么出现"></a>Docker为什么出现</h3><p>一款产品：开发-上线 两套环境！应用环境，应用配置</p>
<p>开发—运维：版本更新导致服务不可用，对于运维来说压力巨大</p>
<p>环境配置十分麻烦，每一个机器都要部署环境（集群Redis、ES、Hadoop…）</p>
<p>发布一个项目，项目与环境一起打包发布。在服务器配置一个应用环境配置麻烦，不能跨平台</p>
<p>Docker给以上问题提出了解决方案：python—py环境—打包项目+环境（镜像）—Docker仓库—下载镜像—直接运行即可</p>
<h3 id="Docker的历史"><a href="#Docker的历史" class="headerlink" title="Docker的历史"></a>Docker的历史</h3><p>2010年，美国成立了一家dotCloud的公司，做一些pass的云计算服务。该公司将自己的技术（容器化技术）命名就是Docker，Docker刚刚诞生的时候并没有引起行业注意。2013年，dotCloud就将该技术开源。在开源之后，Docker每月都会更新一个版本，2014年4月9日，Docker1.0发布</p>
<p>Docker对于虚拟机技术非常轻</p>
<p>虚拟机：在windows中装一个Vmware，通过这个软件我们可以虚拟出一台或多台电脑。（虚拟机也属于虚拟化技术）</p>
<p>容器：容器技术也进行隔离，它仅安装最核心的环境</p>
<p>官网：[Docker官网][<a target="_blank" rel="noopener" href="https://www.docker.com/]">https://www.docker.com/]</a></p>
<p>文档地址：[Docker文档][<a target="_blank" rel="noopener" href="https://docs.docker.com/]">https://docs.docker.com/]</a></p>
<p>仓库地址：[Docker仓库][<a target="_blank" rel="noopener" href="https://hub.docker.com/]">https://hub.docker.com/]</a></p>
<h3 id="Docker用途"><a href="#Docker用途" class="headerlink" title="Docker用途"></a>Docker用途</h3><p>容器化技术不是模拟的一个完整的操作系统</p>
<p>传统模型：</p>
<div align="center">
    <img src="/2023/02/27/Docker/传统模型.jpg" style="zoom: 40%" alt="传统模型">
</div>

<p>Docker模型：</p>
<div align="center">
    <img src="/2023/02/27/Docker/Docker模型.jpg" style="zoom: 40%" alt="Docker模型">
</div>

<p>比较Docker和虚拟机技术的不同：</p>
<ul>
<li>传统虚拟机，虚拟出一条硬件，运行一个完整的操作系统，然后在这个系统上安装和运行软件</li>
<li>容器内的应用直接运行在宿主机的内容，容器是没有自己的内核，也没有虚拟硬件，所以非常轻便</li>
<li>每个容器间是相互隔离的，每个容器内都有一个属于自己的文件系统，互不影响</li>
</ul>
<p><strong>DevOps（开发、运维）</strong></p>
<ul>
<li><p>应用更快的交付和部署、</p>
<p>传统：一堆帮助文档，安装程序</p>
<p>Docker：打包镜像发布测试，一键运行</p>
</li>
<li><p>更便捷的升级和扩缩容</p>
<p>使用Docker之后，我们部署应用就和搭积木一样</p>
<p>项目打包为一个镜像</p>
</li>
<li><p>更简单的系统运维</p>
<p>在容器化之后，我们开发，测试环境高度一致</p>
</li>
<li><p>更高效的计算资源利用</p>
<p>Docker是内核级别的虚拟化，可以在一个物理机上运行很多容器实例，服务器性能可以被压榨到极致</p>
</li>
</ul>
<hr>
<h2 id="Docker的安装"><a href="#Docker的安装" class="headerlink" title="Docker的安装"></a>Docker的安装</h2><h3 id="Docker的基本组成"><a href="#Docker的基本组成" class="headerlink" title="Docker的基本组成"></a>Docker的基本组成</h3><div align="center">
    <img src="/2023/02/27/Docker/Docker架构图.png" style="zoom: 40%" alt="Docker架构图">
</div>

<p><strong>镜像（image）：</strong></p>
<p>Docker就类似一个模板，可以通过这个模板来创建容器服务，tomcat镜像-&gt;run-&gt;tomcat01容器（提供服务），通过这个镜像可以创建多个容器（最终服务运行或者项目运行就是在这个容器中）</p>
<p><strong>容器（container）：</strong></p>
<p>Docker利用容器技术，独立运行一个或者一组应用，通过镜像创建</p>
<p>启动、停止、删除，基本命令</p>
<p>目前就可以把这个容器理解为一个简易的Linux系统</p>
<p><strong>仓库（repository）：</strong></p>
<p>仓库就是存放镜像的地方</p>
<p>仓库分为公有仓库和私有仓库</p>
<p>Docker Hub、阿里云、华为云…（配置镜像加速）</p>
<h3 id="安装Docker"><a href="#安装Docker" class="headerlink" title="安装Docker"></a>安装Docker</h3><p><strong>前期准备：</strong>Linux基础、CentOS7.x</p>
<p><strong>帮助文档：</strong>按照帮助文档的安装流程，找到对应的版本进行安装</p>
<ul>
<li>卸载旧的版本</li>
<li>需要的安装包</li>
<li>设置镜像仓库</li>
<li>更新yum软件包索引</li>
<li>安装Docker相关内容（ce社区版，ee企业版）</li>
<li>启动Docker<code>systemctl start docker</code></li>
<li>测试Hello World<code>docker run hello-world</code></li>
<li>查看下载的hello world镜像<code>docker images</code></li>
</ul>
<div align="center">
    <img src="/2023/02/27/Docker/Docker安装成功.jpg" style="zoom: 100%" alt="Docker安装成功">
</div>

<p><strong>卸载Docker：</strong></p>
<ul>
<li>卸载依赖<code>yum remove ...</code></li>
<li>删除资源<code>rm -rf /var/lib/docker</code></li>
</ul>
<h3 id="阿里云镜像加速器"><a href="#阿里云镜像加速器" class="headerlink" title="阿里云镜像加速器"></a>阿里云镜像加速器</h3><p>在阿里云控制台中查看容器镜像服务-镜像加速器</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo mkdir -p /etc/docker</span><br><span class="line"></span><br><span class="line">sudo tee /etc/docker/daemon.json &lt;&lt;-&#x27;EOF&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  &quot;registry-mirrors&quot;: [&quot;https://19s9qgd0.mirror.aliyuncs.com&quot;]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">sudo systemctl daemon-reload</span><br><span class="line"></span><br><span class="line">sudo systemctl restart docker</span><br></pre></td></tr></table></figure>

<h3 id="Run的流程和Docker原理"><a href="#Run的流程和Docker原理" class="headerlink" title="Run的流程和Docker原理"></a>Run的流程和Docker原理</h3><div align="center">
    <img src="/2023/02/27/Docker/Run流程图.jpg" style="zoom: 40%" alt="Run流程图">
</div>

<p><strong>Docker工作原理：</strong></p>
<p>Docker是一个Client-Server结构的系统，Docker的守护进程运行在主机上。通过Socket从客户端访问</p>
<p>DockerServer接收到Docker-Client的指令，就是执行这个命令</p>
<div align="center">
    <img src="/2023/02/27/Docker/Docker工作原理.jpg" style="zoom: 40%" alt="Docker工作原理">
</div>

<p>Docker有比虚拟机更少的抽象层</p>
<p>Docker利用宿主机的内核，虚拟机需要是Guest OS</p>
<p>新建一个容器的时候，Docker不需要向虚拟机一样重新加载一个操作系统的内核</p>
<hr>
<h2 id="Docker常用命令"><a href="#Docker常用命令" class="headerlink" title="Docker常用命令"></a>Docker常用命令</h2><h3 id="帮助命令"><a href="#帮助命令" class="headerlink" title="帮助命令"></a>帮助命令</h3><p>查看Docker的版本信息：<code>docker version</code></p>
<p>查看Docker的系统信息：<code>docker info</code></p>
<p>帮助命令：<code>docker --help</code></p>
<h3 id="镜像命令"><a href="#镜像命令" class="headerlink" title="镜像命令"></a>镜像命令</h3><p><strong>查看</strong>所有本地的主机上的镜像：<code>docker images</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@iZ2zeilj9g7ro4c0i2813pZ santidadday]# docker images</span><br><span class="line">REPOSITORY    TAG       IMAGE ID       CREATED         SIZE</span><br><span class="line">hello-world   latest    feb5d9fea6a5   17 months ago   13.3kB</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">解释</span></span><br><span class="line">REPOSITORY 仓库镜像源</span><br><span class="line">TAG        镜像的标签</span><br><span class="line">IMAGE ID   镜像ID</span><br><span class="line">CREATED    镜像的创建时间</span><br><span class="line">SIZE       镜像的大小</span><br></pre></td></tr></table></figure>

<p><code>-a</code> 显示全部镜像</p>
<p><code>-q</code> 只显示镜像的id</p>
<p><strong>搜索</strong>镜像：<code>docker search 镜像名</code></p>
<p><code>-f</code> 过滤条件</p>
<p>例如：所有STARS在3000以上的<code>docker searc mysql --filter=STARS=3000</code></p>
<p><strong>下载</strong>镜像：<code>docker pull 镜像名</code></p>
<p>指定下载版本：<code>docker pull 镜像名:tag</code>（如果不写tag，默认下载latest）</p>
<p><strong>删除</strong>镜像：<code>docker rmi -f 镜像id</code></p>
<p><code>-f</code> 全部删除</p>
<p><strong>增加</strong>本地镜像tag：<code>docker tag 镜像id 作者名/镜像名:版本</code></p>
<h3 id="容器命令"><a href="#容器命令" class="headerlink" title="容器命令"></a>容器命令</h3><p>下载一个CentOS测试：<code>docker pull centos</code></p>
<p><strong>新建容器并启动：</strong><code>docker run [选项]</code></p>
<p><code>--name=&quot;Name&quot;</code> 容器名字</p>
<p><code>-d</code> 后台方式启动</p>
<p><code>-it</code> 使用交互方式运行，进入容器查看内容</p>
<p><code>-p</code> 指定容器端（<code>-p ip:主机端口:容器端口</code> <code>-p 主机端口:容器端口</code>（常用） <code>-p 容器端口</code> <code>容器端口</code>）</p>
<p><code>-P</code> 随机指定端口</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">测试,启动并进入容器</span></span><br><span class="line">[root@iZ2zeilj9g7ro4c0i2813pZ santidadday]# docker run -it centos /bin/bash</span><br><span class="line">[root@d9d72d455011 /]</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">exit</span>退出当前容器</span></span><br></pre></td></tr></table></figure>

<p><strong>列出所有正在运行的容器：</strong><code>docker ps</code></p>
<p><code>-a</code> 列出当前正在运行的容器+历史运行过的容器</p>
<p><code>-n=?</code> 显示最近创建的容器</p>
<p><code>-q</code> 只显示容器的编号</p>
<p><strong>退出容器：</strong></p>
<p>容器停止并退出：<code>exit</code></p>
<p>容器不停止退出：<code>Ctrl+p+q</code></p>
<p><strong>删除容器：</strong><code>docker rm 容器id</code></p>
<p>不能删除正在运行的容器，如果需要删除强制删除则使用<code>docker rm -f</code></p>
<p>删除所有容器：</p>
<ul>
<li><code>docker ps -a -q|xargs docker rm</code></li>
<li><code>docker rm -f $(docker ps -aq)</code></li>
</ul>
<p><strong>启动和停止容器操作：</strong></p>
<ul>
<li>启动容器：<code>docker start 容器id</code></li>
<li>重启容器：<code>docker restart 容器id</code></li>
<li>停止当前正在运行容器：<code>docker stop 容器id</code></li>
<li>强制停止当前容器：<code>docker kill 容器id</code></li>
</ul>
<h3 id="其他命令"><a href="#其他命令" class="headerlink" title="其他命令"></a>其他命令</h3><p><strong>后台启动容器：</strong><code>docker run -d 镜像名</code></p>
<p>在后台启动某容器时，必须要有前台进程，Docker发现没有前台应用，就会自动停止</p>
<p><strong>查看日志：</strong><code>docker logs [选项] 容器名</code></p>
<p><code>-tf</code> 显示全部日志</p>
<p><code>-tf --tail n</code> 显示n条日志</p>
<p><strong>查看容器中的进程信息：</strong><code>docker top 容器id</code></p>
<p><strong>查看镜像的元数据：</strong><code>docker inspect 容器id</code></p>
<p><strong>进入当前正在运行的容器：</strong></p>
<p>进入容器后开启一个新的终端：<code>docker exec -it 容器id bashShell</code></p>
<p>进入容器正在执行的终端：<code>docker attach 容器id</code></p>
<p><strong>从容器内拷贝到主机上：</strong><code>docker cp 容器id:容器路径 目的主机路径</code></p>
<p>我们使用卷技术可以实现容器内外数据互传</p>
<div align="center">
    <img src="/2023/02/27/Docker/Docker命令小结.jpg" style="zoom: 30%" alt="Docker命令小结">
</div>
### 测试NGINX

<p><strong>搜索：</strong><code>docker search nginx</code></p>
<p><strong>拉取：</strong><code>docker pull nginx</code></p>
<p><strong>后台运行并暴露端口：</strong><code>docker run -d --name nginx01 -p 3344:80 nginx</code>（3344为自定义外网端口，80为容器端口）</p>
<p>端口暴露：</p>
<div align="center">
    <img src="/2023/02/27/Docker/端口暴露.jpg" style="zoom: 30%" alt="端口暴露">
</div>
### Docker部署es+kibana

<ul>
<li>es需要暴露多个端口</li>
<li>es十分占用内存空</li>
<li>es的数据一般需要放置在安全目录！挂载</li>
</ul>
<p>启动elasticsearch：<code>docker run -d --name elasticsearch -p 9200:9200 -p 9300:9300 -e &quot;discovery.type=single-node&quot; elasticsearch:7.6.2</code></p>
<p>es是十分占用内存空间的，为了解决解决docker启动es后卡死问题，通过增加<code>-e</code>修改配置文件</p>
<p><code>docker run -d --name elasticsearch -p 9200:9200 -p 9300:9300 -e &quot;discovery.type=single-node&quot; -e ES_JAVA_OPTS=&quot;Xms64m -Xmx512&quot; elasticsearch:7.6.2</code></p>
<div align="center">
    <img src="/2023/02/27/Docker/ES+Kibana.jpg" style="zoom: 40%" alt="ES+Kibana">
</div>

<h3 id="可视化"><a href="#可视化" class="headerlink" title="可视化"></a>可视化</h3><ul>
<li><p>portainer</p>
<p><code>docker run -d -p 8088:9000 --restart=always -v /var/run/docker.sock:/var/run/docker.sock --privileged=true portainer/portainer</code></p>
</li>
<li><p>Rancher</p>
</li>
</ul>
<p><strong>portainer：</strong>是Docker图形化见面管理工具，提供一个后台面板供我们操作</p>
<p>一般不会使用</p>
<hr>
<h2 id="镜像原理"><a href="#镜像原理" class="headerlink" title="镜像原理"></a>镜像原理</h2><h3 id="联合文件系统"><a href="#联合文件系统" class="headerlink" title="联合文件系统"></a>联合文件系统</h3><p>镜像是一种轻量级、可执行的独立软件包，用来打包软件运行环境和基于环境开发的软件，它包含运行某些软件所需要的所有内容，包括代码、运行时、库、环境变量和配置文件</p>
<p>所有的应用直接打包称为一个Docker镜像，直接可以运行</p>
<p>得到镜像：</p>
<ul>
<li>从远程仓库下载</li>
<li>朋友拷贝</li>
<li>自己制作一个镜像DockerFile</li>
</ul>
<p>UnionFS（联合文件系统）：是一种分层、轻量级并且高性能的文件系统，它支持对文件系统修改作为一次提交来一层层的叠加，同时可以将不同目录挂载到同一个虚拟文件系统下（unite serveral directories into a single virtual filesystem）。Union文件系统是Docker镜像的基础。镜像可以通过分层来进行继承，基于基础镜像（没有父镜像），可以制作各种具体的应用镜像</p>
<p>特性：一次同时加载多个文件系统，但从外面看起来，只能看到一个文件系统，联合加载会把各层文件系统叠加起来，这样最终的文件系统会包含所有底层的文件和目录</p>
<p>Docker镜像加载原理：</p>
<ul>
<li><p>docker的镜像实际上由一层一层的文件系统组成，这种层级的文件系统UnionFS。</p>
</li>
<li><p>bootfs(boot file system)主要包含bootloader和kernel, bootloader主要是引导加载kernel，Linux刚启动时会加载bootfs文件系统，在Docker镜像的最底层是bootfs。这一层与我们典型的Linux&#x2F;Unix系统是一样的，包含boot加载器和内核。当boot加载完成之后整个内核就都在内存中了，此时内存的使用权已由bootfs转交给内核，此时系统也会卸载bootfs。</p>
</li>
<li><p>rootfs (root file system),在bootfs之上。包含的就是典型 Linux 系统中的 &#x2F;dev，&#x2F;proc，&#x2F;bin，&#x2F;etc 等标准目录和文件。rootfs就是各种不同的操作系统发行版，比如Ubuntu，Centos等等。</p>
</li>
</ul>
<p>对于一个精简的OS，rootfs可以很小，只需要包含最基本的命令，工具和程序库就可以了，因为底层直接使用Host的kernel，自己只需要提供rootfs就可以了。由此可见对于不同的linux发行版，bootfs基本都是一致的，rootfs会有差别，因此不同发行版可以共用bootfs</p>
<h3 id="分层"><a href="#分层" class="headerlink" title="分层"></a>分层</h3><p>所有的Docker镜像都起始于一个基础镜像，当进行修改或增加新的内容时，就会在当前镜像层之上，创建新的镜像</p>
<div align="center">
    <img src="/2023/02/27/Docker/分层01.png" style="zoom: 60%" alt="分层01">
</div>

<p>这种情况下，上层镜像层中的文件覆盖了底层镜像层中的文件。这样就使得文件的更新版本作为一个新镜像层添加到镜像当中</p>
<p>Docker 通过存储引擎（新版本采用快照机制）的方式来实现像层堆栈，并保证多像层对外展示为统一的文件系统</p>
<p>Linux 上可用的存储引擎有 AUFS、 Overlay2、 Device Mapper、Btrfs 以及 ZFS。顾名思义，每种存引擎都基于 Linux 中对应的文件系统或者块设备技术，并且每种存储引警都有其独有的性能特点。Docker 在 Windows 上仅支持 windowsfilter一种存储引，该引擎基于 NTFS 文件系统之上实现了分层和 CoW[1]</p>
<p>下图展示了与系统显示相同的三层镜像。所有镜像层堆叠并合并，对外提供统一的视</p>
<div align="center">
    <img src="/2023/02/27/Docker/分层02.png" style="zoom: 60%" alt="分层02">
</div>

<h3 id="Commit镜像"><a href="#Commit镜像" class="headerlink" title="Commit镜像"></a>Commit镜像</h3><p>提交容器称为一个新的副本：<code>docker commit</code></p>
<p><code>docker commit -m=&quot;提交的描述信息&quot; -a=&quot;作者&quot; 容器id 目标镜像名:[TAG]</code></p>
<hr>
<h2 id="容器数据卷"><a href="#容器数据卷" class="headerlink" title="容器数据卷"></a>容器数据卷</h2><h3 id="什么是容器数据卷"><a href="#什么是容器数据卷" class="headerlink" title="什么是容器数据卷"></a>什么是容器数据卷</h3><p>数据在容器中，如果容器删除数据就会丢失。我们需要将数据进行持久化保存</p>
<p>容器之间可以有一个共享的技术！Docker容器中产生的数据同步到本地</p>
<p>数据卷：目录的挂载，将我们的容器内的目录，挂载到Linux上面</p>
<p>容器的持久化和同步操作，容器间也可以数据共享</p>
<h3 id="使用数据卷"><a href="#使用数据卷" class="headerlink" title="使用数据卷"></a>使用数据卷</h3><p><strong>启用容器并挂载数据卷：</strong><code>docker run -it -v 主机目录:容器目录 镜像名 </code></p>
<p>案例：<strong>挂载MySQL：</strong><code>docker run -d --name mysql01 -p 3306:3306 -v /home/mysql:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456 mysql:5.7</code></p>
<h3 id="具名挂载-amp-匿名挂载"><a href="#具名挂载-amp-匿名挂载" class="headerlink" title="具名挂载&amp;匿名挂载"></a>具名挂载&amp;匿名挂载</h3><p><strong>匿名挂载：</strong><code>docker run -d -P --name nginx01 -v /etc/nginx nginx</code></p>
<p>在挂载时，指写了容器内的路径，没有些容器外的路径</p>
<p><strong>具名挂载：</strong><code>docker run -d -P --name nginx01 -v j-nginx:/etc/nginx nginx</code></p>
<p>通过<code>-v 卷名:容器内路径</code></p>
<p>使用<code>docker volume inspect 卷名</code>查看挂载路径</p>
<p>所有的Docker容器内的卷，没有指定目录的情况下都是在：&#x2F;var&#x2F;lib&#x2F;docker&#x2F;volumes&#x2F;xxxx&#x2F;_date</p>
<p>我们通过具名挂载可以方便的找到我们的一个卷，大多数情况使用的是具名挂载</p>
<h3 id="初识DockerFile"><a href="#初识DockerFile" class="headerlink" title="初识DockerFile"></a>初识DockerFile</h3><p>DockerFile就是用来构建docker镜像的构建文件，命令脚本</p>
<p>通过这个脚本就可以生成镜像，镜像是一层一层的，脚本是一个个的命令，每个命令都是一层镜像</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建一个dockerfile1文件</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">文件中的内容 指令(大写)</span></span><br><span class="line">FROM centos</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">匿名挂载</span></span><br><span class="line">VOLUME [&quot;volume01&quot;, &quot;volume02&quot;]</span><br><span class="line"></span><br><span class="line">CMD echo &quot;------end-------&quot;</span><br><span class="line">CMD /bin/bash</span><br></pre></td></tr></table></figure>

<p>在&#x2F;home&#x2F;docker-test-volume下：<code>docker build -f dockerfile1 -t santidadday/centos .</code></p>
<p>假设构建镜像时候没有挂载卷，要手动镜像挂载<code>-v 卷名:容器内路径</code></p>
<h3 id="数据卷容器"><a href="#数据卷容器" class="headerlink" title="数据卷容器"></a>数据卷容器</h3><p>例如：多个mysql同步数据</p>
<p><code>--volume-from 容器名</code></p>
<p>此处容器名类似于父类，类似于去中心化拷贝</p>
<hr>
<h2 id="DockerFile"><a href="#DockerFile" class="headerlink" title="DockerFile"></a>DockerFile</h2><h3 id="DockerFile介绍"><a href="#DockerFile介绍" class="headerlink" title="DockerFile介绍"></a>DockerFile介绍</h3><p>DockerFile是用来构建Docker镜像的文件</p>
<p>构建步骤：</p>
<ul>
<li>编写一个DockerFile文件</li>
<li><code>docker build</code>构建一个镜像</li>
<li><code>docker run</code>运行镜像</li>
<li><code>docker push</code>发布镜像（DockerHub、阿里云）</li>
</ul>
<h3 id="DockerFile构建过程"><a href="#DockerFile构建过程" class="headerlink" title="DockerFile构建过程"></a>DockerFile构建过程</h3><p>基础：</p>
<ul>
<li>每个保留关键字（指令）都必须是大写字母</li>
<li>执行从上到下顺序执行</li>
<li>#表示注释</li>
<li>每一个指令都会创建提交一个新的镜像层</li>
</ul>
<p>DockerFile是面向开发的，我们以后发布项目，做镜像就需要编写DockerFile文件</p>
<p>Docker镜像逐渐称为企业的交付标准</p>
<p>步骤：</p>
<ul>
<li><p>DockerFile：构建文件，定义了一切步骤，源代码</p>
</li>
<li><p>DockerImages：通过DockerFile构建生成镜像，最终发布和运行的产品</p>
</li>
<li><p>Docker容器：容器就是镜像运行起来提供服务的</p>
</li>
</ul>
<h3 id="DockerFile指令"><a href="#DockerFile指令" class="headerlink" title="DockerFile指令"></a>DockerFile指令</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">FROM                  # 基础镜像,一切从这里开始构件</span><br><span class="line">MAINTAINER            # 镜像是谁负责的:姓名+邮箱</span><br><span class="line">RUN                   # 镜像构建时候需要运行的命令</span><br><span class="line">ADD                   # 步骤:tomcat镜像,这个tomcat压缩包!添加内容</span><br><span class="line">WORKDIR               # 镜像的工作目录</span><br><span class="line">VOLUME                # 挂载目录</span><br><span class="line">EXPORT                # 指定对外端口</span><br><span class="line">CMD                   # 指定容器启动时运行的命令,只有最后一条命令生效</span><br><span class="line">ENTRYPOINT            # 指定容器启动时运行的命令,可以追加命令</span><br><span class="line">ONBUILD               # 当构建一个被继承的DockerFile,这个时候就会运行ONBUILD的指令,触发指令</span><br><span class="line">COPY                  # 类似ADD,将文件拷贝到镜像中</span><br><span class="line">ENV                   # 构建的时候设置环境变量</span><br></pre></td></tr></table></figure>

<h3 id="CentOS实战"><a href="#CentOS实战" class="headerlink" title="CentOS实战"></a>CentOS实战</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">编写DockerFile文件</span></span><br><span class="line">FROM centos:centos7</span><br><span class="line"></span><br><span class="line">MAINTAINER santidadday&lt;1393399898@qq.com&gt;</span><br><span class="line"></span><br><span class="line">ENV MYPATH /usr/local</span><br><span class="line">WORKDIR $MYPATH</span><br><span class="line"></span><br><span class="line">RUN yum -y install vim</span><br><span class="line">RUN yum -y install net-tools</span><br><span class="line"></span><br><span class="line">EXPOSE 80</span><br><span class="line"></span><br><span class="line">CMD echo $MYPATH</span><br><span class="line">CMD echo &quot;-------end-------&quot;</span><br><span class="line">CMD /bin/bash</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">通过这个文件构建镜像</span></span><br><span class="line">docker build -f dockerfile文件名 -t 镜像名:[tag]</span><br><span class="line">docker build -f mydockerfile -t mycentos:0.1</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">测试运行</span></span><br><span class="line">docker run -it mycentos:0.1</span><br></pre></td></tr></table></figure>

<h3 id="CMD和ENTRYPOINT区别"><a href="#CMD和ENTRYPOINT区别" class="headerlink" title="CMD和ENTRYPOINT区别"></a>CMD和ENTRYPOINT区别</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">FROM centos:centos7</span><br><span class="line">CMD [&quot;ls&quot;,&quot;-a&quot;]</span><br></pre></td></tr></table></figure>

<p>构建镜像只有最后一个CMD生效</p>
<p>如果我们希望在docker run后追加一个命令（-l）：<code>docker run 镜像名 ls -al</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">FROM centos:centos7</span><br><span class="line">ENTRYPOINT [&quot;ls&quot;,&quot;-a&quot;]</span><br></pre></td></tr></table></figure>

<p>在ENTRYPOINT下，可以实现追加效果：<code>docker run 镜像名 -l</code></p>
<h3 id="实战tomcat镜像"><a href="#实战tomcat镜像" class="headerlink" title="实战tomcat镜像"></a>实战tomcat镜像</h3><p>需要准备镜像文件：tomcat压缩包，jdk压缩包</p>
<p>编写Dockerfile文件，官方命名，build会自动寻找这个文件，就不需要-f指定了</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">FROM centos</span><br><span class="line">MAINTAINER santidadday&lt;1393399898@qq.com&gt;</span><br><span class="line"></span><br><span class="line">COPY readme.txt /usr/local/readme.txt</span><br><span class="line">ADD jdk-8u11-linux-x64.tar.gz /usr/local/</span><br><span class="line">ADD apache-tomcat-9.0.22.tar.gz /usr/local/</span><br><span class="line"></span><br><span class="line">RUN yum -y install vim</span><br><span class="line"></span><br><span class="line">ENV MYPATH /usr/local</span><br><span class="line">WORKDIR $MYPATH</span><br><span class="line"></span><br><span class="line">ENV JAVA_HOME /usr/1ocal/jdk1.8.0_11</span><br><span class="line">ENV CLASSPATH $JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar</span><br><span class="line">ENV CATALINA_HOME /usr/local/apache-tomcat-9.0.22</span><br><span class="line">ENV CATALINA_BASH /usr/Tocal/apache-tomcat-9.0.22</span><br><span class="line">ENV PATH $PATH:$JAVA_HOME/bin:$CATALINA_HOME/lib:$CATALINA_HOME/bin</span><br><span class="line"></span><br><span class="line">EXPOSE 8080</span><br><span class="line">CMD /usr/local/apache-tomcat-9.0,22/bin/startup.sh &amp;&amp; tail -F /url/1ocal/apache-tomcat-9.0.22/bin/logs/catalina.out</span><br></pre></td></tr></table></figure>

<p>构建镜像：<code>docker build -t diytomcat .</code></p>
<p>启动镜像</p>
<p>访问测试</p>
<p>发布项目（我们将容器内挂载到本地，就可以在本地进行编写程序）</p>
<hr>
<h2 id="发布自己的镜像"><a href="#发布自己的镜像" class="headerlink" title="发布自己的镜像"></a>发布自己的镜像</h2><h3 id="DockerHub"><a href="#DockerHub" class="headerlink" title="DockerHub"></a>DockerHub</h3><p>地址：<a target="_blank" rel="noopener" href="https://hub.docker.com/%E6%B3%A8%E5%86%8C%E8%87%AA%E5%B7%B1%E7%9A%84%E8%B4%A6%E5%8F%B7">https://hub.docker.com/注册自己的账号</a></p>
<p>确定这个账号可以登录</p>
<p>在我们的服务器上提交自己的镜像</p>
<p><code>docker login -u 用户名 -p 密码</code></p>
<p>登录完毕后就可以提交镜像了：<code>docker push 作者名/镜像名:版本</code></p>
<h3 id="阿里云镜像服务"><a href="#阿里云镜像服务" class="headerlink" title="阿里云镜像服务"></a>阿里云镜像服务</h3><p>登录阿里云</p>
<p>找到容器镜像服务</p>
<p>创建命名空间</p>
<p>创建容器镜像</p>
<p>浏览阿里云镜像信息</p>
<hr>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><div align="center">
    <img src="/2023/02/27/Docker/小结.png" style="zoom: 60%" alt="小结">
</div>

<hr>
<h2 id="Docker网络"><a href="#Docker网络" class="headerlink" title="Docker网络"></a>Docker网络</h2><h3 id="理解Docker0"><a href="#理解Docker0" class="headerlink" title="理解Docker0"></a>理解Docker0</h3><p>清空之前练习的容器及镜像：<code>docker rm -f $(docker ps -aq)</code> <code>docker rmi -f $(docker images -aq)</code></p>
<p>查看网络：<code>ip addr</code>，eth0为本机地址，eth1位阿里云内网地址，docker0类似路由器地址（192.168.0.1）</p>
<p>查看容器的内部网络地址：<code>docker exec -it 容器名 ip addr</code></p>
<p>Linux可以ping通Docker容器内部</p>
<p><strong>原理：</strong></p>
<ul>
<li>我们每启动一个Docker容器，Docker就会给Docker容器分配一个ip，我们只要安装了Docker就会有一个网卡docker0。桥接模式，使用的技术是evth-pair</li>
<li>每启动一个Docker容器就会多出一对网卡</li>
<li>容器和容器之间可以相互ping通的</li>
</ul>
<p>veth-pair，就是一对虚拟设备接口，他们都是成对出现的，一端连着协议，一端彼此相连。我们通常使用这个特性，使其充当一个桥梁，连接各种虚拟网络设备</p>
<div align="center">
    <img src="/2023/02/27/Docker/桥接.jpg" style="zoom: 40%" alt="Docker桥接">
</div>

<p>所有的容器不指定网络的情况下，都是docker0路由的，docker会给我们的路由器分配一个默认的可用ip</p>
<div align="center">
    <img src="/2023/02/27/Docker/Linux桥接.jpg" style="zoom: 40%" alt="Linux桥接">
</div>

<p>Docker中所有的网络接口都是虚拟的。虚拟的转发效率高（内网传递文件）</p>
<p>容器移除后，对应的网桥就自动删除了</p>
<h3 id="–link"><a href="#–link" class="headerlink" title="–link"></a>–link</h3><p>使用场景：项目不重启，数据库ip换了，我们希望可以通过名字进行访问容器</p>
<p>在启动docker时，通过增加选项，例如：<code>docker run -d -P --name tomcat03 --link tomcat02 tomcat</code></p>
<p>可以在一个Docker容器内通过容器名ping通另一个容器</p>
<p>正向可以ping通不代表反向可以ping通</p>
<p>可以查看到容器的网络内容：<code>docker network inspect 容器id</code></p>
<p>在&#x2F;etc&#x2F;hosts下进行配置：<code>docker exec -it 容器名 cat /etc/hosts</code></p>
<p>在真实开发环境中，一般不进行使用</p>
<h3 id="自定义网络"><a href="#自定义网络" class="headerlink" title="自定义网络"></a>自定义网络</h3><p>查看所有Docker网络信息：<code>docker network ls</code></p>
<p><strong>网络模式：</strong></p>
<ul>
<li>bridge：桥接（默认，自定义的网络也使用桥接模式）</li>
<li>none：不配置网络</li>
<li>host：主机模式，和宿主机共享网络</li>
<li>container：容器网络连通（局限性大，用的较少）</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run -d -P --name tomcat01 --net bridge tomcat</span><br><span class="line">docker run -d -P --name tomcat01 tomcat</span><br></pre></td></tr></table></figure>

<p>创建自己的网络：<code>docker network create --driver bridge --subnet 192.168.0.0/16 --geteway 192.168.0.1 mynet</code></p>
<p>网络模式：<code>--driver bridge</code></p>
<p>子网地址：<code>--subnet 192.168.0.0/16</code></p>
<p>网关：<code>--geteway 192.168.0.1</code></p>
<p>自定义的网络内部，不同容器可以相互ping通</p>
<h3 id="网路连通"><a href="#网路连通" class="headerlink" title="网路连通"></a>网路连通</h3><div align="center">
    <img src="/2023/02/27/Docker/网络连通.jpg" style="zoom: 40%" alt="网络连通">
</div>

<p>将图示中的tomcat-01与Mynet连通：<code>docker network connect Mynet tomcat-01</code></p>
<h3 id="部署Redis集群实战"><a href="#部署Redis集群实战" class="headerlink" title="部署Redis集群实战"></a>部署Redis集群实战</h3><div align="center">
    <img src="/2023/02/27/Docker/Redis集群.jpg" style="zoom: 40%" alt="Redis集群">
</div>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">for port in $(seq 1 6); \</span><br><span class="line">do \</span><br><span class="line">mkdir -p /mydata/redis/node-$&#123;port&#125;/conf</span><br><span class="line">touch /mydata/redis/node-$&#123;port&#125;/conf/redis.conf</span><br><span class="line">cat &lt;&lt; EOF &gt;/mydata/redis/node-$&#123;port&#125;/conf/redis.conf</span><br><span class="line">port 6379 </span><br><span class="line">bind 0.0.0.0</span><br><span class="line">cluster-enabled yes </span><br><span class="line">cluster-config-file nodes.conf</span><br><span class="line">cluster-node-timeout 5000</span><br><span class="line">cluster-announce-ip 172.38.0.1$&#123;port&#125;</span><br><span class="line">cluster-announce-port 6379</span><br><span class="line">cluster-announce-bus-port 16379</span><br><span class="line">appendonly yes</span><br><span class="line">EOF</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">docker run -p 6371:6379 -p 16371:6379 --name redis-1 \</span><br><span class="line">-v /mydata/redis/node-1/data:/data \</span><br><span class="line">-v /mydata/redis/node-1/conf/redis.conf:/etc/redis/redis.conf \</span><br><span class="line">-d --net redis --ip 172.38.0.11 redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf</span><br><span class="line"></span><br><span class="line">docker run -p 6372:6379 -p 16372:6379 --name redis-2 \</span><br><span class="line">-v /mydata/redis/node-2/data:/data \</span><br><span class="line">-v /mydata/redis/node-2/conf/redis.conf:/etc/redis/redis.conf \</span><br><span class="line">-d --net redis --ip 172.38.0.12 redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf</span><br><span class="line"></span><br><span class="line">docker run -p 6373:6379 -p 16373:6379 --name redis-3 \</span><br><span class="line">-v /mydata/redis/node-3/data:/data \</span><br><span class="line">-v /mydata/redis/node-3/conf/redis.conf:/etc/redis/redis.conf \</span><br><span class="line">-d --net redis --ip 172.38.0.13 redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf</span><br><span class="line"></span><br><span class="line">docker run -p 6374:6379 -p 16374:6379 --name redis-4 \</span><br><span class="line">-v /mydata/redis/node-4/data:/data \</span><br><span class="line">-v /mydata/redis/node-4/conf/redis.conf:/etc/redis/redis.conf \</span><br><span class="line">-d --net redis --ip 172.38.0.14 redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf</span><br><span class="line"></span><br><span class="line">docker run -p 6375:6379 -p 16375:6379 --name redis-5 \</span><br><span class="line">-v /mydata/redis/node-5/data:/data \</span><br><span class="line">-v /mydata/redis/node-5/conf/redis.conf:/etc/redis/redis.conf \</span><br><span class="line">-d --net redis --ip 172.38.0.15 redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf</span><br><span class="line"></span><br><span class="line">docker run -p 6376:6379 -p 16376:6379 --name redis-6 \</span><br><span class="line">-v /mydata/redis/node-6/data:/data \</span><br><span class="line">-v /mydata/redis/node-6/conf/redis.conf:/etc/redis/redis.conf \</span><br><span class="line">-d --net redis --ip 172.38.0.16 redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf</span><br><span class="line"></span><br><span class="line">docker exec -it redis-1 /bin/sh</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建集群</span></span><br><span class="line">redis-cli --cluster create 172.38.0.11:6379 172.38.0.12:6379 172.38.0.13:6379 172.38.0.14:6379 172.38.0.15:6379 172.38.0.16:6379 --cluster-replicas 1</span><br></pre></td></tr></table></figure>

</article><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Docker/">Docker</a><a class="post-meta__tags" href="/tags/Linux/">Linux</a><a class="post-meta__tags" href="/tags/Notes/">Notes</a></div><div class="post_share"><div class="social-share" data-image="https://www.ondat.io/hubfs/Docker.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/03/14/C++/"><img class="prev-cover" src="https://upload.wikimedia.org/wikipedia/commons/thumb/1/18/ISO_C%2B%2B_Logo.svg/1200px-ISO_C%2B%2B_Logo.svg.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">C++</div></div></a></div><div class="next-post pull-right"><a href="/2023/02/17/Linux%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/"><img class="next-cover" src="https://tools.wingzero.tw/assets/upload/1639016963439_0.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">Linux</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><div><a href="/2023/03/16/CMake/" title="CMake"><img class="cover" src="https://www.kitware.com/main/wp-content/uploads/2016/11/CMake-Logo-and-Text-e1540917038464.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-03-16</div><div class="title">CMake</div></div></a></div><div><a href="/2023/03/14/C++/" title="C++"><img class="cover" src="https://upload.wikimedia.org/wikipedia/commons/thumb/1/18/ISO_C%2B%2B_Logo.svg/1200px-ISO_C%2B%2B_Logo.svg.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-03-14</div><div class="title">C++</div></div></a></div><div><a href="/2023/02/06/Flask/" title="Flask"><img class="cover" src="https://upload.wikimedia.org/wikipedia/commons/thumb/3/3c/Flask_logo.svg/1200px-Flask_logo.svg.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-02-06</div><div class="title">Flask</div></div></a></div><div><a href="/2023/01/30/Git/" title="Git GitHub"><img class="cover" src="https://editor.analyticsvidhya.com/uploads/18288git.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-01-30</div><div class="title">Git GitHub</div></div></a></div><div><a href="/2023/02/17/Linux%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" title="Linux"><img class="cover" src="https://tools.wingzero.tw/assets/upload/1639016963439_0.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-02-17</div><div class="title">Linux</div></div></a></div><div><a href="/2022/02/15/Golang/" title="Golang"><img class="cover" src="http://5b0988e595225.cdn.sohucs.com/images/20190127/98d2709000f649198967eb6e91d26a1a.jpeg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-02-15</div><div class="title">Golang</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/day.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">santidad DAY</div><div class="author-info__description">今日事，今日毕</div></div><div class="card-info-data is-center"><div class="card-info-data-item"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">17</div></a></div><div class="card-info-data-item"><a href="/tags/"><div class="headline">Tags</div><div class="length-num">9</div></a></div><div class="card-info-data-item"><a href="/categories/"><div class="headline">Categories</div><div class="length-num">1</div></a></div></div><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/santidadday" target="_blank" title="Github"><i class="fab fa-github"></i></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker%E6%A6%82%E8%BF%B0"><span class="toc-number">1.</span> <span class="toc-text">Docker概述</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Docker%E4%B8%BA%E4%BB%80%E4%B9%88%E5%87%BA%E7%8E%B0"><span class="toc-number">1.1.</span> <span class="toc-text">Docker为什么出现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Docker%E7%9A%84%E5%8E%86%E5%8F%B2"><span class="toc-number">1.2.</span> <span class="toc-text">Docker的历史</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Docker%E7%94%A8%E9%80%94"><span class="toc-number">1.3.</span> <span class="toc-text">Docker用途</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker%E7%9A%84%E5%AE%89%E8%A3%85"><span class="toc-number">2.</span> <span class="toc-text">Docker的安装</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Docker%E7%9A%84%E5%9F%BA%E6%9C%AC%E7%BB%84%E6%88%90"><span class="toc-number">2.1.</span> <span class="toc-text">Docker的基本组成</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85Docker"><span class="toc-number">2.2.</span> <span class="toc-text">安装Docker</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%98%BF%E9%87%8C%E4%BA%91%E9%95%9C%E5%83%8F%E5%8A%A0%E9%80%9F%E5%99%A8"><span class="toc-number">2.3.</span> <span class="toc-text">阿里云镜像加速器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Run%E7%9A%84%E6%B5%81%E7%A8%8B%E5%92%8CDocker%E5%8E%9F%E7%90%86"><span class="toc-number">2.4.</span> <span class="toc-text">Run的流程和Docker原理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">3.</span> <span class="toc-text">Docker常用命令</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%AE%E5%8A%A9%E5%91%BD%E4%BB%A4"><span class="toc-number">3.1.</span> <span class="toc-text">帮助命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%95%9C%E5%83%8F%E5%91%BD%E4%BB%A4"><span class="toc-number">3.2.</span> <span class="toc-text">镜像命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%B9%E5%99%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">3.3.</span> <span class="toc-text">容器命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E5%91%BD%E4%BB%A4"><span class="toc-number">3.4.</span> <span class="toc-text">其他命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%AF%E8%A7%86%E5%8C%96"><span class="toc-number">3.5.</span> <span class="toc-text">可视化</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%95%9C%E5%83%8F%E5%8E%9F%E7%90%86"><span class="toc-number">4.</span> <span class="toc-text">镜像原理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%81%94%E5%90%88%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F"><span class="toc-number">4.1.</span> <span class="toc-text">联合文件系统</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E5%B1%82"><span class="toc-number">4.2.</span> <span class="toc-text">分层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Commit%E9%95%9C%E5%83%8F"><span class="toc-number">4.3.</span> <span class="toc-text">Commit镜像</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%B9%E5%99%A8%E6%95%B0%E6%8D%AE%E5%8D%B7"><span class="toc-number">5.</span> <span class="toc-text">容器数据卷</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E5%AE%B9%E5%99%A8%E6%95%B0%E6%8D%AE%E5%8D%B7"><span class="toc-number">5.1.</span> <span class="toc-text">什么是容器数据卷</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%95%B0%E6%8D%AE%E5%8D%B7"><span class="toc-number">5.2.</span> <span class="toc-text">使用数据卷</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B7%E5%90%8D%E6%8C%82%E8%BD%BD-amp-%E5%8C%BF%E5%90%8D%E6%8C%82%E8%BD%BD"><span class="toc-number">5.3.</span> <span class="toc-text">具名挂载&amp;匿名挂载</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9D%E8%AF%86DockerFile"><span class="toc-number">5.4.</span> <span class="toc-text">初识DockerFile</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%8D%B7%E5%AE%B9%E5%99%A8"><span class="toc-number">5.5.</span> <span class="toc-text">数据卷容器</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DockerFile"><span class="toc-number">6.</span> <span class="toc-text">DockerFile</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#DockerFile%E4%BB%8B%E7%BB%8D"><span class="toc-number">6.1.</span> <span class="toc-text">DockerFile介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DockerFile%E6%9E%84%E5%BB%BA%E8%BF%87%E7%A8%8B"><span class="toc-number">6.2.</span> <span class="toc-text">DockerFile构建过程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DockerFile%E6%8C%87%E4%BB%A4"><span class="toc-number">6.3.</span> <span class="toc-text">DockerFile指令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CentOS%E5%AE%9E%E6%88%98"><span class="toc-number">6.4.</span> <span class="toc-text">CentOS实战</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CMD%E5%92%8CENTRYPOINT%E5%8C%BA%E5%88%AB"><span class="toc-number">6.5.</span> <span class="toc-text">CMD和ENTRYPOINT区别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E6%88%98tomcat%E9%95%9C%E5%83%8F"><span class="toc-number">6.6.</span> <span class="toc-text">实战tomcat镜像</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%91%E5%B8%83%E8%87%AA%E5%B7%B1%E7%9A%84%E9%95%9C%E5%83%8F"><span class="toc-number">7.</span> <span class="toc-text">发布自己的镜像</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#DockerHub"><span class="toc-number">7.1.</span> <span class="toc-text">DockerHub</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%98%BF%E9%87%8C%E4%BA%91%E9%95%9C%E5%83%8F%E6%9C%8D%E5%8A%A1"><span class="toc-number">7.2.</span> <span class="toc-text">阿里云镜像服务</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%8F%E7%BB%93"><span class="toc-number">8.</span> <span class="toc-text">小结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker%E7%BD%91%E7%BB%9C"><span class="toc-number">9.</span> <span class="toc-text">Docker网络</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%90%86%E8%A7%A3Docker0"><span class="toc-number">9.1.</span> <span class="toc-text">理解Docker0</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%80%93link"><span class="toc-number">9.2.</span> <span class="toc-text">–link</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BD%91%E7%BB%9C"><span class="toc-number">9.3.</span> <span class="toc-text">自定义网络</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E8%B7%AF%E8%BF%9E%E9%80%9A"><span class="toc-number">9.4.</span> <span class="toc-text">网路连通</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%83%A8%E7%BD%B2Redis%E9%9B%86%E7%BE%A4%E5%AE%9E%E6%88%98"><span class="toc-number">9.5.</span> <span class="toc-text">部署Redis集群实战</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2023/12/01/Linux%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/" title="Linux网络编程"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Linux网络编程"/></a><div class="content"><a class="title" href="/2023/12/01/Linux%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/" title="Linux网络编程">Linux网络编程</a><time datetime="2023-11-30T16:00:00.000Z" title="Created 2023-12-01 00:00:00">2023-12-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/11/03/ROS/" title="ROS基础"><img src="https://d2908q01vomqb2.cloudfront.net/ca3512f4dfa95a03169c5a670a4c91a19b3077b4/2018/11/26/ros-logo.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ROS基础"/></a><div class="content"><a class="title" href="/2023/11/03/ROS/" title="ROS基础">ROS基础</a><time datetime="2023-11-02T16:00:00.000Z" title="Created 2023-11-03 00:00:00">2023-11-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/07/04/C++11/" title="C++11"><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/1/18/ISO_C%2B%2B_Logo.svg/1200px-ISO_C%2B%2B_Logo.svg.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="C++11"/></a><div class="content"><a class="title" href="/2023/07/04/C++11/" title="C++11">C++11</a><time datetime="2023-07-03T16:00:00.000Z" title="Created 2023-07-04 00:00:00">2023-07-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/06/20/Linux%E7%B3%BB%E7%BB%9F%E7%BC%96%E7%A8%8B/" title="Linux系统编程"><img src="https://file.rymooc.com/SuperLargeCover/200303ae51194686d43e" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Linux系统编程"/></a><div class="content"><a class="title" href="/2023/06/20/Linux%E7%B3%BB%E7%BB%9F%E7%BC%96%E7%A8%8B/" title="Linux系统编程">Linux系统编程</a><time datetime="2023-06-19T16:00:00.000Z" title="Created 2023-06-20 00:00:00">2023-06-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/05/11/C++%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" title="C++设计模式"><img src="https://picx.zhimg.com/v2-f7e5e75bb391e9c74762d9dbee97f807_720w.jpg?source=172ae18b" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="C++设计模式"/></a><div class="content"><a class="title" href="/2023/05/11/C++%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" title="C++设计模式">C++设计模式</a><time datetime="2023-05-10T16:00:00.000Z" title="Created 2023-05-11 00:00:00">2023-05-11</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2021 - 2025 By santidad DAY</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">welcome  to  my  <a  target="_blank" rel="noopener" href="https://butterfly.js.org/">blog</a>!</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><div class="js-pjax"></div><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="true" data-click="true"></script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/click-heart.min.js" async="async" mobile="true"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>